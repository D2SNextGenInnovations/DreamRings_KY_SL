@model IEnumerable<MrGroom_KY_SL.Models.Staff>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Admin - Staff";
    bool isManageMode = Request.QueryString["manage"] == "true";
    <link href="~/Content/custom-styles.css" rel="stylesheet" />;
}

<!-- PAGE HEADER -->
<div class="page-header d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <div class="d-flex align-items-center gap-2">
        <div class="page-header-icon">
            <i class="fas fa-users"></i>
        </div>
        <h3 class="page-title mb-0">Staff</h3>
    </div>
</div>

<hr class="soft-gradient-line" />

<!-- SUMMARY CARDS -->
<div class="row g-3 mb-4">
    <div class="col-md-3 col-sm-6">
        <div class="card stat-card border-0 shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                <div class="icon-circle bg-primary text-white me-3"><i class="fas fa-user"></i></div>
                <div>
                    <h6 class="text-muted mb-1">Total Staff</h6>
                    <h3 class="mb-0 fw-bold">@Model.Count()</h3>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card stat-card border-0 shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                <div class="icon-circle bg-success text-white me-3"><i class="fas fa-check-circle"></i></div>
                <div>
                    <h6 class="text-muted mb-1">Active Staff</h6>
                    <h3 class="mb-0 fw-bold">@Model.Count(s => s.IsActive ?? false)</h3>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card stat-card border-0 shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                <div class="icon-circle bg-warning text-dark me-3"><i class="fas fa-user-slash"></i></div>
                <div>
                    <h6 class="text-muted mb-1">Inactive Staff</h6>
                    <h3 class="mb-0 fw-bold">@Model.Count(s => !(s.IsActive ?? false))</h3>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card stat-card border-0 shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                <div class="icon-circle bg-info text-white me-3"><i class="fas fa-briefcase"></i></div>
                <div>
                    <h6 class="text-muted mb-1">Roles</h6>
                    <h3 class="mb-0 fw-bold">@Model.Select(s => s.Role).Distinct().Count()</h3>
                </div>
            </div>
        </div>
    </div>
</div>

<hr class="soft-gradient-line" />

<!-- SEARCH + ADD -->
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    @using (Html.BeginForm("Index", "Staff", FormMethod.Get))
    {
        <div class="search-bar-soft d-flex align-items-center">
            <input type="text" name="searchTerm" placeholder="Search staff..." value="@ViewBag.SearchTerm" />
            <button type="submit"><i class="fas fa-search"></i></button>
        </div>
    }

    <a href="@Url.Action("Create", "Staff")" class="fab-btn-inline">
        <i class="fas fa-plus"></i><span class="ms-2">Add Staff</span>
    </a>
</div>

<hr class="soft-gradient-line" />

<!-- TABLE + PAGINATION -->
<div id="staffContainer">
    @Html.Partial("_StaffTable", Model)
</div>

@section Scripts {
    <script>
        $(document).on("click", ".ajax-page", function (e) {
            e.preventDefault();
            var url = $(this).attr("href");

            $.ajax({
                url: url,
                type: "GET",
                dataType: "html",
                beforeSend: function () {
                    $("#staffContainer").css("opacity", "0.6");
                },
                success: function (data) {
                    if ($(data).find("#staffContainer").length) {
                        $("#staffContainer").html($(data).find("#staffContainer").html());
                    } else {
                        $("#staffContainer").html(data);
                    }
                    $("#staffContainer").css("opacity", "1");
                    $('[data-bs-toggle="tooltip"]').tooltip();
                },
                error: function () {
                    alert("Failed to load data. Please try again.");
                    $("#staffContainer").css("opacity", "1");
                }
            });
        });
    </script>
}
