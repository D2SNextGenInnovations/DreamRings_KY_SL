@model MrGroom_KY_SL.Models.Booking

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Booking Details";
}

<style>
    .booking-header {
        background: linear-gradient(135deg, #0d6efd, #6610f2);
        color: #fff;
        border-radius: 1rem;
        padding: 2.5rem 2rem;
        box-shadow: 0 10px 25px rgba(13, 110, 253, 0.25);
    }

        .booking-header h2 {
            font-weight: 700;
            font-size: 2rem;
        }

    .booking-meta {
        color: #e0e0e0;
        font-size: 1rem;
        margin-top: 0.5rem;
    }

    .section-title {
        font-weight: 600;
        font-size: 1.25rem;
        color: #333;
        border-left: 5px solid #0d6efd;
        padding-left: 10px;
        margin-bottom: 1rem;
    }

    .card-modern {
        border: none;
        border-radius: 1rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        background-color: #fff;
        transition: all 0.3s ease;
    }

        .card-modern:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.12);
        }

    .no-data {
        background: #f9fafb;
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
        color: #666;
        font-style: italic;
    }

    .btn-gradient {
        background: linear-gradient(135deg, #0d6efd, #6610f2);
        color: #fff;
        border: none;
        transition: all 0.3s ease;
    }

        .btn-gradient:hover {
            background: linear-gradient(135deg, #3b82f6, #9333ea);
            transform: translateY(-2px);
            color: #fff;
        }

    .divider {
        border-bottom: 2px dashed #ddd;
        margin: 2rem 0;
    }

    .status-badge {
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
        border-radius: 30px;
        font-weight: 600;
    }

    .status-pending {
        background-color: #fff3cd;
        color: #856404;
    }

    .status-confirmed {
        background-color: #d1e7dd;
        color: #0f5132;
    }

    .status-cancelled {
        background-color: #f8d7da;
        color: #842029;
    }

    /* Package Photos */
    .photo-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }

        .photo-gallery img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 0.75rem;
            transition: transform 0.3s ease;
        }

            .photo-gallery img:hover {
                transform: scale(1.05);
            }

    /* Package Items */
    .package-items-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

        .package-items-list li {
            background: #f8f9fa;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

            .package-items-list li i {
                color: #0d6efd;
                margin-right: 8px;
            }
</style>

<div class="container py-5">

    <!-- Header -->
    <div class="booking-header mb-5 d-flex justify-content-between align-items-center flex-wrap">
        <div>
            <h2><i class="bi bi-calendar-event me-2"></i> Booking #@Model.BookingId</h2>
            <div class="booking-meta">
                <strong>Event Date:</strong> @Model.EventDate.ToString("yyyy-MM-dd") <br />
                <strong>Booking Date:</strong> @Model.BookingDate.ToString("yyyy-MM-dd") <br />
                <strong>Location:</strong> @Model.Location <br />
                <strong>Status</strong>
                @if (Model.Status == "Pending")
                {
                    <span class="badge bg-warning">Pending</span>
                }
                else if (Model.Status == "Confirmed")
                {
                    <span class="badge bg-success">Confirmed</span>
                }
                else if (Model.Status == "Cancelled")
                {
                    <span class="badge bg-danger">Cancelled</span>
                }
                else
                {
                    <span class="badge bg-secondary">Unknown</span>

                }
            </div>
        </div>
        <a href="@Url.Action("Index", "AdminBookings")" class="btn btn-light rounded-pill px-4 mt-3 mt-md-0">
            <i class="bi bi-arrow-left-circle me-1"></i> Back to List
        </a>
    </div>

    <!-- Customer, Event, Package -->
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card-modern p-4 h-100">
                <h5 class="section-title"><i class="bi bi-person-fill me-2"></i> Customer Details</h5>
                <dl class="row mb-0">
                    <dt class="col-sm-5"><strong>Name</strong></dt>
                    <dd class="col-sm-7">@Model.Customer.FirstName @Model.Customer.LastName</dd>

                    <dt class="col-sm-5"><strong>Email</strong></dt>
                    <dd class="col-sm-7 text-break">@Model.Customer.Email</dd>

                    <dt class="col-sm-5"><strong>Phone</strong></dt>
                    <dd class="col-sm-7">@Model.Customer.Phone</dd>

                    <dt class="col-sm-5"><strong>NIC</strong></dt>
                    <dd class="col-sm-7">@Model.Customer.NICNumber</dd>
                </dl>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card-modern p-4 h-100">
                <h5 class="section-title"><i class="bi bi-stars me-2"></i> Event Type</h5>
                <dl class="row mb-0">
                    <dt class="col-sm-5"><strong>Name</strong></dt>
                    <dd class="col-sm-7">@Model.EventType.Name</dd>

                    <dt class="col-sm-5"><strong>Price</strong></dt>
                    <dd class="col-sm-7">@String.Format("Rs {0:N2}", Model.EventType?.Price ?? 0)</dd>

                    <dt class="col-sm-5"><strong>Active</strong></dt>
                    <dd class="col-sm-7">@(Model.EventType?.IsActive == true ? "Yes" : "No")</dd>
                </dl>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card-modern p-4 h-100">
                <h5 class="section-title"><i class="bi bi-box-seam me-2"></i> Package Details</h5>
                <dl class="row mb-0">
                    <dt class="col-sm-5"><strong>Name</strong></dt>
                    <dd class="col-sm-7">@Model.Package.Name</dd>

                    <dt class="col-sm-5"><strong>Base Price</strong></dt>
                    <dd class="col-sm-7">@String.Format("Rs {0:N2}", Model.Package?.BasePrice ?? 0)</dd>

                    <dt class="col-sm-5"><strong>Duration</strong></dt>
                    <dd class="col-sm-7">@(Model.Package?.DurationHours ?? 0) hours</dd>

                    @if (!string.IsNullOrEmpty(Model.Package?.Description))
                    {
                        <dt class="col-sm-5"><strong>Description</strong></dt>
                        <dd class="col-sm-7">@Model.Package.Description</dd>
                    }
                </dl>
            </div>
        </div>
    </div>


    <!-- Package Photos -->
    @if (Model.Package?.PackagePhotos != null && Model.Package.PackagePhotos.Any())
    {
        <h5 class="section-title"><i class="bi bi-image-fill me-2"></i> Package Photos</h5>
        <div class="photo-gallery mb-5">
            @foreach (var photo in Model.Package.PackagePhotos)
            {
                <img src="@Url.Content(photo.PhotoUrl)" alt="Package Photo" class="shadow-sm" />
            }
        </div>
    }

    <!-- Package Items -->
    @if (Model.Package?.PackageItems != null && Model.Package.PackageItems.Any())
    {
        <h5 class="section-title"><i class="bi bi-list-check me-2"></i> Package Items</h5>
        <ul class="package-items-list mb-5">
            @foreach (var item in Model.Package.PackageItems)
            {
                <li><i class="bi bi-check-circle-fill"></i> @item.Name</li>
            }
        </ul>
    }

    <div class="divider"></div>

    <!-- Staff Members -->
    <h5 class="section-title"><i class="bi bi-people-fill me-2"></i> Assigned Staff</h5>
    @if (Model.StaffMembers != null && Model.StaffMembers.Any())
    {
        <div class="row g-3 mb-5">
            @foreach (var staff in Model.StaffMembers)
            {
                <div class="col-md-4">
                    <div class="card-modern p-4 h-100">
                        <h5>
                            <i class="bi bi-person-badge me-2"></i> @staff.Name
                        </h5>
                        <dl class="row mb-0">
                            <dt class="col-sm-5"><strong>Role</strong></dt>
                            <dd class="col-sm-7">@staff.Role</dd>

                            <dt class="col-sm-5"><strong>Phone</strong></dt>
                            <dd class="col-sm-7">@staff.Phone</dd>

                            <dt class="col-sm-5"><strong>Email</strong></dt>
                            <dd class="col-sm-7 text-break">@staff.Email</dd>
                        </dl>
                    </div>
                </div>
            }
        </div>

    }
    else
    {
        <div class="no-data mb-5"><i class="bi bi-info-circle me-2"></i> No staff assigned.</div>
    }

    <div class="divider"></div>

    <!-- Payments -->
    <h5 class="section-title"><i class="bi bi-cash-stack me-2"></i> Payments</h5>
    @if (Model.Payments != null && Model.Payments.Any())
    {
        <div class="table-responsive card-modern p-4">
            <table class="table align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Method</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var payment in Model.Payments.OrderByDescending(p => p.PaymentDate))
                    {
                        <tr>
                            <td>@payment.PaymentDate.ToString("yyyy-MM-dd")</td>
                            <td>@String.Format("Rs {0:N2}", payment.Amount)</td>
                            <td>@payment.PaymentMethod</td>
                            <td>@payment.PaymentType</td>
                            <td>@payment.Status</td>
                            <td>@payment.Remarks</td>
                        </tr>
                    }
                </tbody>
            </table>

            <div class="col-md-4">
                <div class="card-modern p-4 h-100">
                    <h5>
                        <i class="bi bi-credit-card-2-front me-2"></i> Payment Details
                    </h5>
                    <dl class="row mb-0">
                        <dt class="col-sm-5"><strong>Total Paid</strong></dt>
                        <dd class="col-sm-7">@String.Format("Rs {0:N2}", Model.TotalPaid)</dd>

                        <dt class="col-sm-5"><strong>Remaining</strong></dt>
                        <dd class="col-sm-7">@String.Format("Rs {0:N2}", Model.RemainingAmount)</dd>

                        <dt class="col-sm-5"><strong>Status</strong></dt>
                        <dd class="col-sm-7 fw-bold text-break">@Model.PaymentStatus</dd>
                    </dl>
                </div>
            </div>

        </div>
    }
    else
    {
        <div class="no-data mb-5"><i class="bi bi-info-circle me-2"></i> No payments recorded.</div>
    }

    <div class="text-center mt-5">
        <a href="@Url.Action("Index", "AdminBookings")" class="btn btn-gradient rounded-pill px-5 py-2">
            <i class="bi bi-arrow-left-circle me-2"></i> Back to Bookings
        </a>
    </div>
</div>

@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
}
