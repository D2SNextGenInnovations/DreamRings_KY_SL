@model IEnumerable<MrGroom_KY_SL.Models.PackageItem>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Admin - Package Items";
    bool isManageMode = Request.QueryString["manage"] == "true";
    <link href="~/Content/custom-styles.css" rel="stylesheet" />;
}

<!-- PAGE HEADER -->
<div class="page-header d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <div class="d-flex align-items-center gap-2">
        <div class="page-header-icon">
            <i class="fas fa-box-open"></i>
        </div>
        <h3 class="page-title mb-0">Package Items</h3>
    </div>
</div>

<hr class="soft-gradient-line" />

<!-- SUMMARY CARDS -->
<div class="row g-3 mb-4">
    <div class="col-md-3 col-sm-6">
        <div class="card stat-card border-0 shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                <div class="icon-circle bg-primary text-white me-3">
                    <i class="fas fa-cubes"></i>
                </div>
                <div>
                    <h6 class="text-muted mb-1">Total Items</h6>
                    <h3 class="mb-0 fw-bold">@Model.Count()</h3>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card stat-card border-0 shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                <div class="icon-circle bg-success text-white me-3">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div>
                    <h6 class="text-muted mb-1">Active Items</h6>
                    <h3 class="mb-0 fw-bold">@Model.Count(i => i.IsActive ?? false)</h3>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card stat-card border-0 shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                <div class="icon-circle bg-warning text-dark me-3">
                    <i class="fas fa-pause-circle"></i>
                </div>
                <div>
                    <h6 class="text-muted mb-1">Inactive Items</h6>
                    <h3 class="mb-0 fw-bold">@Model.Count(i => !(i.IsActive ?? false))</h3>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card stat-card border-0 shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                <div class="icon-circle bg-info text-white me-3">
                    <i class="fas fa-coins"></i>
                </div>
                <div>
                    <h6 class="text-muted mb-1">Total Value (Rs)</h6>
                    <h3 class="mb-0 fw-bold">@Model.Sum(i => i.Price)</h3>
                </div>
            </div>
        </div>
    </div>
</div>

<hr class="soft-gradient-line" />

<!-- SEARCH + CREATE -->
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    @using (Html.BeginForm("Index", "AdminPackageItems", FormMethod.Get))
    {
        <div class="search-bar-soft d-flex align-items-center">
            <input type="text" name="searchTerm" placeholder="Search..." value="@ViewBag.SearchTerm" />
            <button type="submit"><i class="fas fa-search"></i></button>
        </div>
    }

    <a href="@Url.Action("Create", "AdminPackageItems")" class="fab-btn-inline">
        <i class="fas fa-plus"></i>
        <span class="ms-2">Create New</span>
    </a>
</div>

<hr class="soft-gradient-line" />

<!-- TABLE + PAGINATION -->
<div id="packageItemsContainer">
    @Html.Partial("_PackageItemsTable", Model)
</div>

@section Scripts {
    <script>
        $(document).on("click", ".ajax-page", function (e) {
            e.preventDefault();
            var url = $(this).attr("href");

            $.ajax({
                url: url,
                type: "GET",
                dataType: "html",
                beforeSend: function () {
                    $("#packageItemsContainer").css("opacity", "0.6");
                },
                success: function (data) {
                    // If only partial returned, replace entire container
                    if ($(data).find("#packageItemsContainer").length) {
                        $("#packageItemsContainer").html($(data).find("#packageItemsContainer").html());
                    } else {
                        $("#packageItemsContainer").html(data);
                    }
                    $("#packageItemsContainer").css("opacity", "1");
                    $('[data-bs-toggle="tooltip"]').tooltip();
                },
                error: function () {
                    alert("Failed to load data. Please try again.");
                    $("#packageItemsContainer").css("opacity", "1");
                }
            });
        });
    </script>
}
